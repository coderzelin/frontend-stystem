### 性能优化

我们所谈论的页面优化，其实就是要让页面更快的显示和响应，所以要进行性能优化就要分析一个页面的生存周期的不同阶段

通常一个页面有三个阶段：加载阶段、交互阶段和关闭阶段

- 加载阶段，是指从发出请求到渲染出完整页面的过程，影响到这个阶段的主要阶段有网络和 js 脚本
- 交互阶段，主要是从页面加载完成到用户交互的整合过程，影响到这个阶段主要的因素是 js 脚本
- 关闭阶段，主要是用户发出关闭指令后页面所做的一些清理操作

能阻塞网页首次渲染的资源称为关键资源，关键资源有 html、css、js，总的优化原则就是减少关键资源的大小、数量，降低关键资源的 RTT 次数

优化策略：

- 把 css 文件放在 html 头部，对 css 进行压缩
- 把 js 文件放在 html 底部，或者加上的 defer、async 属性，对 js 进行压缩
- 升级到 http 2.0，因为 http 1.1 的队头阻塞问题，一个域名最多有 6 个 tcp 连接，或者采用域名分片技术，可以并发传输多张图片
- prefetch 预拉取将来要用到的资源，preload 预加载首屏的关键资源（图片、字体、样式等），dns-prefetch 预解析域名
- 使用 cdn，http 缓存
- 使用 gzip 压缩资源的体积，提升传输效率
- 压缩图片的大小，选择正确的图片格式，使用 iconfont，webp
- 交互阶段，减少重绘重排，使用 css 动画，使用 will-change 单独创建一个图层

---

### 虚拟列表

因为 DOM 元素的创建和渲染需要的时间成本很高，在数据量大的情况下，渲染列表的时间太长，虚拟列表就是可视区域渲染的列表

两个重要的概念

- 可滚动区域：假设有 1000 条数据，每个列表项的高度是 30，那么可滚动区域的高度就是 1000*30。当用户改变列表的滚动条的当前滚动值的时候，会造成可视区域的内容变更
- 可视区域：比如列表的高度是 300，那么可视区域就是 300

实现虚拟列表：

- 计算当前可视区域的起始数据的 startIndex
- 计算当前可视区域的结束数据的 endIndex
- 计算列表项中从 startIndex 到 endIndex 的数据，并渲染到页面中
- 计算 startIndex 在整个列表中偏移位置 startOffset，并设置到列表中

![image](https://pic3.zhimg.com/80/v2-f00bb3f5d9815d660d7bcbd87236af86_1440w.jpg)

---

### preload & prefetch

不同资源加载的优先级规则

![image](https://user-gold-cdn.xitu.io/2018/2/11/16182c9d3ff9f3c2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)
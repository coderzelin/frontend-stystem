### 浏览器安全

#### 同源策略

如果两个 URL 的协议，域名，端口号都相同，则这两个 URL 同源，同源策略会隔离不同源的 DOM 操作、页面数据、网络通信，进而实现 web 页面的安全

#### CSP（内容安全策略）

CSP 的核心思想是让服务器决定浏览器能够加载那些资源，让服务器决定浏览器是否能执行内联 javascript 代码，可以通过 HTTP 响应头设置，或者 meta 属性设置如 `<meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src https://*; child-src 'none';">`

```js
Content-Security-Policy: policy
```

#### CORS

实现 CORS 通信的关键是服务器，只要服务器实现了 CORS 接口，就可以跨源通信，浏览器将 CORS 请求分成简单请求和非简单请求

简单请求需要同时满足下面两大条件

1. 请求方法是下面三种方法之一
   - HEAD
   - GET
   - POST
2. HTTP 头信息不超出以下字段
   - Accept
   - Accept-Language
   - Content-Language
   - Content-Type: 只限于 application/x-www-form-urlencoded`、`multipart/form-data`、`text/plain

如果不能同时满足上面两个条件的都属于非简单请求

#### 安全和便利性的权衡

如果要绝对的安全就要牺牲便利性，因此需要在二者之前找到平衡点，也就是页面安全策略原型，具有下面的特点：

1. 页面可以引用第三方资源，不过也暴露了很多如 XSS 安全问题，所以又引入 CSP 来限制其自由程度
2. 使用 XMLHttpRequest 和 Fetch 都是无法直接进行跨域请求，因此引入了跨域资源共享策略（CORS），让其可以安全的进行跨域操作
3. 两个不同源的 DOM 是不能相互操纵的，因此，浏览器又实现了跨文档消息机制，可以通过 window.postMessage 的 js 接口和不同源的 DOM 通信

